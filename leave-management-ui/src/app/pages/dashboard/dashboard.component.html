<div class="dashboard-main-container">
  <div class="dashboard-content">
    <!-- HEADER -->
    <div class="dashboard-header">
      <span class="dashboard-welcome">Welcome Back, {{ userName }}</span>
      <span class="role-tag employee" *ngIf="!isManager">EMPLOYEE</span>
      <span class="role-tag manager" *ngIf="isManager">MANAGER</span>
    </div>

    <!-- STATISTICS (Single Section, No Duplication) -->
    <div class="dashboard-stats-section">
      <h2 class="dashboard-title">Leave Statistics</h2>
      <div *ngIf="isLoading" class="dashboard-loading">
        <mat-progress-spinner mode="indeterminate" color="primary"></mat-progress-spinner>
        <p>Loading your statistics...</p>
      </div>
      <div *ngIf="!isLoading" class="dashboard-stats-grid">
        <div class="dashboard-stat-card total">
          <div class="dashboard-stat-label">Total Requests</div>
          <div class="dashboard-stat-value">{{ summary.totalRequests }}</div>
        </div>
        <div class="dashboard-stat-card approved">
          <div class="dashboard-stat-label">Approved</div>
          <div class="dashboard-stat-value">{{ summary.approvedRequests }}</div>
        </div>
        <div class="dashboard-stat-card pending">
          <div class="dashboard-stat-label">Pending</div>
          <div class="dashboard-stat-value">{{ summary.pendingRequests }}</div>
        </div>
        <div class="dashboard-stat-card rejected">
          <div class="dashboard-stat-label">Rejected</div>
          <div class="dashboard-stat-value">{{ summary.rejectedRequests }}</div>
        </div>
        <div class="dashboard-stat-card days-requested">
          <div class="dashboard-stat-label">Days Requested</div>
          <div class="dashboard-stat-value">{{ summary.totalDaysRequested }}</div>
        </div>
        <div class="dashboard-stat-card days-approved">
          <div class="dashboard-stat-label">Days Approved</div>
          <div class="dashboard-stat-value">{{ summary.totalDaysApproved }}</div>
        </div>
      </div>
    </div>


    <!-- MANAGER SECTION -->
    <div *ngIf="isManager">
      <h2 class="dashboard-title" style="margin-top:32px;">New Requests</h2>
      <mat-progress-spinner *ngIf="requestsLoading" mode="indeterminate" color="primary"></mat-progress-spinner>
      <div *ngIf="!requestsLoading && requestsError" class="error-message">{{ requestsError }}</div>
      <table mat-table *ngIf="!requestsLoading && !requestsError" [dataSource]="pendingDataSource" matSort #pendingSort="matSort" class="dashboard-table mat-elevation-z2">
        <!-- ID -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
          <td mat-cell *matCellDef="let r">{{ r.id }}</td>
        </ng-container>
        <!-- User -->
        <ng-container matColumnDef="userName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>User</th>
          <td mat-cell *matCellDef="let r">{{ r.userName }}</td>
        </ng-container>
        <!-- Dates -->
        <ng-container matColumnDef="dates">
          <th mat-header-cell *matHeaderCellDef>Dates</th>
          <td mat-cell *matCellDef="let r">{{ r.startDate | date:'MMM dd' }} → {{ r.endDate | date:'MMM dd, yyyy' }}</td>
        </ng-container>
        <!-- Days -->
        <ng-container matColumnDef="days">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Days</th>
          <td mat-cell *matCellDef="let r">{{ r.daysCount }}</td>
        </ng-container>
        <!-- Reason -->
        <ng-container matColumnDef="reason">
          <th mat-header-cell *matHeaderCellDef>Reason</th>
          <td mat-cell *matCellDef="let r">{{ r.reason }}</td>
        </ng-container>
        <!-- Status -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let r"><span class="status-badge status-pending">Pending</span></td>
        </ng-container>
        <!-- Comment -->
        <ng-container matColumnDef="comment">
          <th mat-header-cell *matHeaderCellDef>Manager Comment</th>
          <td mat-cell *matCellDef="let r"><input class="comment-box" placeholder="Add comment" [(ngModel)]="r._comment"></td>
        </ng-container>
        <!-- Actions -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let r">
            <button class="approve-btn" (click)="approve(r)">Approve</button>
            <button class="reject-btn" (click)="reject(r)">Reject</button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="pendingColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: pendingColumns"></tr>
      </table>
      <mat-paginator #pendingPaginator [pageSize]="5" [pageSizeOptions]="[5, 10, 20]" class="mat-paginator"></mat-paginator>
      <h2 class="dashboard-title" style="margin-top:40px;">Past Requests</h2>
      <table mat-table [dataSource]="pastDataSource" matSort #pastSort="matSort" class="dashboard-table mat-elevation-z2">
        <!-- ID -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
          <td mat-cell *matCellDef="let r">{{ r.id }}</td>
        </ng-container>
        <!-- User -->
        <ng-container matColumnDef="userName">
          <th mat-header-cell *matHeaderCellDef>User</th>
          <td mat-cell *matCellDef="let r">{{ r.userName }}</td>
        </ng-container>
        <!-- Dates -->
        <ng-container matColumnDef="dates">
          <th mat-header-cell *matHeaderCellDef>Dates</th>
          <td mat-cell *matCellDef="let r">{{ r.startDate | date:'MMM dd' }} → {{ r.endDate | date:'MMM dd, yyyy' }}</td>
        </ng-container>
        <!-- Days -->
        <ng-container matColumnDef="days">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Days</th>
          <td mat-cell *matCellDef="let r">{{ r.daysCount }}</td>
        </ng-container>
        <!-- Reason -->
        <ng-container matColumnDef="reason">
          <th mat-header-cell *matHeaderCellDef>Reason</th>
          <td mat-cell *matCellDef="let r">{{ r.reason }}</td>
        </ng-container>
        <!-- Status -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let r"><span class="status-badge" [ngClass]="{'status-approved': r.status === 'Approved', 'status-rejected': r.status === 'Rejected'}">{{ r.status }}</span></td>
        </ng-container>
        <!-- Manager Comments -->
        <ng-container matColumnDef="managerComments">
          <th mat-header-cell *matHeaderCellDef>Manager Comments</th>
          <td mat-cell *matCellDef="let r">{{ r.managerComments || '-' }}</td>
        </ng-container>
        <!-- Created -->
        <ng-container matColumnDef="createdAt">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Created</th>
          <td mat-cell *matCellDef="let r">{{ r.createdAt | date:'MMM dd, yyyy' }}</td>
        </ng-container>
        <!-- Reviewed -->
        <ng-container matColumnDef="reviewedAt">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Reviewed</th>
          <td mat-cell *matCellDef="let r">{{ r.reviewedAt ? (r.reviewedAt | date:'MMM dd, yyyy') : '-' }}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="pastColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: pastColumns"></tr>
      </table>
      <mat-paginator #pastPaginator [pageSize]="5" [pageSizeOptions]="[5, 10, 20]" class="mat-paginator"></mat-paginator>
    </div>

    <!-- EMPLOYEE SECTION -->
    <div *ngIf="!isManager">
      <h2 class="dashboard-title" style="margin-top:32px;">My Leave Requests</h2>
      <mat-progress-spinner *ngIf="requestsLoading" mode="indeterminate" color="primary"></mat-progress-spinner>
      <div *ngIf="!requestsLoading && requestsError" class="error-message">{{ requestsError }}</div>
      <table mat-table *ngIf="!requestsLoading && !requestsError" [dataSource]="pastDataSource" matSort #pastSort="matSort" class="dashboard-table mat-elevation-z2">
        <!-- ID -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
          <td mat-cell *matCellDef="let r">{{ r.id }}</td>
        </ng-container>
        <!-- Dates -->
        <ng-container matColumnDef="dates">
          <th mat-header-cell *matHeaderCellDef>Dates</th>
          <td mat-cell *matCellDef="let r">{{ r.startDate | date:'MMM dd' }} → {{ r.endDate | date:'MMM dd, yyyy' }}</td>
        </ng-container>
        <!-- Days -->
        <ng-container matColumnDef="days">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Days</th>
          <td mat-cell *matCellDef="let r">{{ r.daysCount }}</td>
        </ng-container>
        <!-- Reason -->
        <ng-container matColumnDef="reason">
          <th mat-header-cell *matHeaderCellDef>Reason</th>
          <td mat-cell *matCellDef="let r">{{ r.reason }}</td>
        </ng-container>
        <!-- Status -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let r"><span class="status-badge" [ngClass]="{'status-approved': r.status === 'Approved', 'status-rejected': r.status === 'Rejected', 'status-pending': r.status === 'Pending'}">{{ r.status }}</span></td>
        </ng-container>
        <!-- Manager Comments -->
        <ng-container matColumnDef="managerComments">
          <th mat-header-cell *matHeaderCellDef>Manager Comments</th>
          <td mat-cell *matCellDef="let r">{{ r.managerComments || '-' }}</td>
        </ng-container>
        <!-- Created -->
        <ng-container matColumnDef="createdAt">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Created</th>
          <td mat-cell *matCellDef="let r">{{ r.createdAt | date:'MMM dd, yyyy' }}</td>
        </ng-container>
        <!-- Reviewed -->
        <ng-container matColumnDef="reviewedAt">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Reviewed</th>
          <td mat-cell *matCellDef="let r">{{ r.reviewedAt ? (r.reviewedAt | date:'MMM dd, yyyy') : '-' }}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="pastColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: pastColumns"></tr>
      </table>
      <mat-paginator #pastPaginator [pageSize]="5" [pageSizeOptions]="[5, 10, 20]"></mat-paginator>
    </div>
  </div>
</div>

