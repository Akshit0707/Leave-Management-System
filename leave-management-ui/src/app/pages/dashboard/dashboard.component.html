


<div class="dashboard-main-container">

  <div class="dashboard-content">
    <div class="dashboard-header">
      <span class="dashboard-welcome">Welcome Back, {{ userName }}</span>
      <span class="role-tag employee" *ngIf="!isManager">EMPLOYEE</span>
      <span class="role-tag manager" *ngIf="isManager">MANAGER</span>
    </div>
    <h2 class="dashboard-title">Leave Statistics</h2>
    <div *ngIf="isLoading" class="dashboard-loading">
      <mat-progress-spinner mode="indeterminate" color="primary"></mat-progress-spinner>
      <p>Loading your statistics...</p>
    </div>
    <div *ngIf="!isLoading" class="dashboard-stats-grid">
      <div class="dashboard-stat-card" *ngFor="let stat of [
        { label: 'Total Requests', value: summary.totalRequests },
        { label: 'Approved', value: summary.approvedRequests },
        { label: 'Pending', value: summary.pendingRequests },
        { label: 'Rejected', value: summary.rejectedRequests },
        { label: 'Days Requested', value: summary.totalDaysRequested },
        { label: 'Days Approved', value: summary.totalDaysApproved }
      ]">
        <div class="dashboard-stat-label">{{ stat.label }}</div>
        <div class="dashboard-stat-value">{{ stat.value }}</div>
      </div>
    </div>
    <div *ngIf="isManager">
      <h2 class="dashboard-title" style="margin-top:32px;">New Requests</h2>
      <div *ngIf="requestsLoading">Loading requests...</div>
      <div *ngIf="!requestsLoading && requestsError" class="error-message">{{ requestsError }}</div>
      <table *ngIf="!requestsLoading && !requestsError && pendingRequests.length > 0" class="dashboard-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>User</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Days</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Created At</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let req of pendingRequests">
            <td>{{ req.id }}</td>
            <td>{{ req.userName }}</td>
            <td>{{ req.startDate | date: 'MMM dd, yyyy' }}</td>
            <td>{{ req.endDate | date: 'MMM dd, yyyy' }}</td>
            <td>{{ req.daysCount }}</td>
            <td>{{ req.reason }}</td>
            <td>{{ req.status }}</td>
            <td>{{ req.createdAt | date: 'MMM dd, yyyy' }}</td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="!requestsLoading && !requestsError && pendingRequests.length === 0">No new requests.</div>

      <h2 class="dashboard-title" style="margin-top:32px;">Past Requests</h2>
      <table *ngIf="!requestsLoading && !requestsError && pastRequests.length > 0" class="dashboard-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>User</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Days</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Manager Comments</th>
            <th>Created At</th>
            <th>Reviewed At</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let req of pastRequests">
            <td>{{ req.id }}</td>
            <td>{{ req.userName }}</td>
            <td>{{ req.startDate | date: 'MMM dd, yyyy' }}</td>
            <td>{{ req.endDate | date: 'MMM dd, yyyy' }}</td>
            <td>{{ req.daysCount }}</td>
            <td>{{ req.reason }}</td>
            <td>{{ req.status }}</td>
            <td>{{ req.managerComments || '-' }}</td>
            <td>{{ req.createdAt | date: 'MMM dd, yyyy' }}</td>
            <td>{{ req.reviewedAt ? (req.reviewedAt | date: 'MMM dd, yyyy') : '-' }}</td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="!requestsLoading && !requestsError && pastRequests.length === 0">No past requests.</div>
    </div>
  </div>
</div>
